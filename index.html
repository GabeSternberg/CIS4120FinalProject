<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Your Profile</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Italiana&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
  <style>
    .edit-icon { width: 20px; height: 20px; cursor: pointer; vertical-align: middle; margin-left: 8px; }
    .profile-pic { width: 225px; height: 225px; object-fit: cover; }
    .collapsible-card { margin-bottom: 1rem; border: 1px solid #ccc; border-radius: 8px; }
    .collapsible-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 0.5rem; }
    .collapsible-header h3 { font-size: 1.5rem; margin: 0; }
    .toggle-arrow { transition: transform 0.2s; }
    .toggle-arrow.open { transform: rotate(90deg); }
    .collapsible-content { display: none; padding: 0.5rem; }
    .collapsible-content.show { display: block; }
    .collapsible-content ul li {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 0.5rem;
      margin-bottom: 0.5rem;
      list-style: none;
      font-size: 1.2rem;
    }
    .draggable-item { display: flex; align-items: center; margin-bottom: 0.5rem; }
    .drag-handle { cursor: grab; margin-right: 8px; }
    .delete-btn { background: none; border: none; cursor: pointer; margin-left: 8px; font-size: 1rem; }
    .matches-grid { display: flex; gap: 1rem; justify-content: space-between; }
    .match-card {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 1rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      min-height: 350px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .dm-btn {
      border: 2px solid #000;
      background: transparent;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      font-family: 'JetBrains Mono', monospace;
      display: block;
      width: 80%;
      margin: 0.5rem auto 0;
      text-align: center;
    }
    .dm-btn:hover { background: #eee; }
    .match-pic { width: 100%; height: auto; border-radius: 4px; }
    .opt-in-section { padding: 1rem; text-align: center; }
    .opt-in-section p { margin-bottom: 0.5rem; }
    .opt-in-section button { padding: 0.5rem 1rem; border: 1px solid #000; background: #fff; cursor: pointer; border-radius: 4px; }
    .opt-in-section button:hover { background: #f0f0f0; }
  </style>
</head>
<body>
  <div class="container">
    <div class="profile-header"><h1>Your Profile</h1></div>
    <div class="rectangular-box"><div class="inner-box"><div class="profile-info-container">
      <div class="profile-details">
        <h2>
          <span id="editableName">Gabe Sternberg</span>
          <img src="edit.png" alt="Edit" id="editBtn" class="edit-icon">
        </h2>
        <p id="editableCollege">College: UPenn</p>
        <p id="editableMajor">Major(s): Computer Science</p>
        <p id="editableYear">Year: 2027</p>
        <p id="editableDorm">Dorm: Harnwell</p>
      </div>
      <div class="profile-pic-wrapper">
        <img src="gabe.png" alt="Profile Picture" class="profile-pic">
        <button id="updatePicBtn">Update Profile Picture</button>
      </div>
    </div></div></div>

    <div class="top-sections">
      <div class="rectangular-box collapsible-card">
        <div class="inner-box">
          <div class="collapsible-header"><h3>Top Interests</h3><span class="toggle-arrow">▶</span></div>
          <div class="collapsible-content">
            <ul id="topInterestsList"></ul>
            <input type="text" id="newInterest" placeholder="Add interest and hit Enter">
          </div>
        </div>
      </div>
      <div class="rectangular-box collapsible-card">
        <div class="inner-box">
          <div class="collapsible-header"><h3>Top Artists</h3><span class="toggle-arrow">▶</span></div>
          <div class="collapsible-content">
            <ul id="topArtistsList"></ul>
            <input type="text" id="newArtist" placeholder="Add artist and hit Enter">
          </div>
        </div>
      </div>
      <div class="rectangular-box collapsible-card">
        <div class="inner-box">
          <div class="collapsible-header"><h3>Schedule</h3><span class="toggle-arrow">▶</span></div>
          <div class="collapsible-content">
            <ul id="topScheduleList"></ul>
            <input type="text" id="newSchedule" placeholder="Add course and hit Enter">
          </div>
        </div>
      </div>
    </div>

    <div class="rectangular-box"><div class="inner-box">
      <div class="opt-in-section">
        <p id="optInText">New matches 4/19 7PM EST - You have not opted in yet</p>
        <button id="optInBtn">Opt In</button>
      </div>
    </div></div>

    <div class="rectangular-box matches-section"><div class="inner-box">
      <h3>This Week’s Matches</h3>
      <div class="matches-grid">
        <div class="match-card">
          <img src="michael.png" alt="Michael" class="match-pic">
          <div class="match-info">
            <p>Name: Michael</p><p>Major: Marketing</p><p>Year: 2025</p><p>Dorm: The Quad</p>
          </div>
          <button class="dm-btn" onclick="location.href='chat.html?user=Michael'">DM</button>
        </div>
        <div class="match-card">
          <img src="jesse.png" alt="Jesse" class="match-pic">
          <div class="match-info">
            <p>Name: Jesse</p><p>Major: Chemistry</p><p>Year: 2026</p><p>Dorm: Stouffer</p>
          </div>
          <button class="dm-btn" onclick="location.href='chat.html?user=Jesse'">DM</button>
        </div>
        <div class="match-card">
          <img src="mark.png" alt="Mark" class="match-pic">
          <div class="match-info">
            <p>Name: Mark</p><p>Major: Astrophysics</p><p>Year: 2024</p><p>Dorm: Harnwell</p>
          </div>
          <button class="dm-btn" onclick="location.href='chat.html?user=Mark'">DM</button>
        </div>
      </div>
    </div></div>

    <div class="bottom-nav">
      <a href="index.html"><img src="profile.png" class="nav-icon" alt="Profile"></a>
      <a href="chat.html"><img src="chat.png" class="nav-icon" alt="Chat"></a>
      <a href="communities.html"><img src="community.png" class="nav-icon" alt="Community"></a>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- 1) Persist editable profile fields ---
      const fieldIds = [
        'editableName',
        'editableCollege',
        'editableMajor',
        'editableYear',
        'editableDorm'
      ];
      const fields = fieldIds.map(id => document.getElementById(id));

      function loadProfile() {
        fields.forEach(f => {
          const saved = localStorage.getItem(f.id);
          if (saved !== null) {
            f.textContent = saved;
          }
        });
      }
      function saveProfile() {
        fields.forEach(f => {
          localStorage.setItem(f.id, f.textContent.trim());
        });
      }
      loadProfile();

      const editBtn = document.getElementById('editBtn');
      let editing = false;
      editBtn.addEventListener('click', () => {
        editing = !editing;
        fields.forEach(f => {
          f.contentEditable = editing;
          f.style.border = editing ? '1px dashed #ccc' : 'none';
        });
        if (!editing) saveProfile();
      });

      // --- 2) Persist profile picture with toggle ---
      const picEl     = document.querySelector('.profile-pic');
      const UPDATE_BTN = document.getElementById('updatePicBtn');
      const PIC_KEY     = 'profilePicSrc';

      // on load: restore whatever you saved (or leave default)
      const savedPic = localStorage.getItem(PIC_KEY);
      if (savedPic) {
        picEl.src = savedPic;
      }

      // on click: flip between the two filenames
      UPDATE_BTN.addEventListener('click', () => {
        // grab the filename from src
        const current = picEl.getAttribute('src');
        // decide next; look for 'updated.png' substring
        const next = current.includes('updated.png') ? 'gabe.png' : 'updated.png';
        picEl.src = next;
        localStorage.setItem(PIC_KEY, next);
      });


      // --- 3) Collapsible sections ---
      document.querySelectorAll('.collapsible-header').forEach(header => {
        header.addEventListener('click', () => {
          const content = header.nextElementSibling;
          content.classList.toggle('show');
          header.querySelector('.toggle-arrow').classList.toggle('open');
        });
      });

      // --- 4) Drag & drop lists ---
      let dragSrc = null;
      function saveList(key, id) {
        const arr = Array.from(document.getElementById(id)
          .querySelectorAll('.item-text'))
          .map(e => e.textContent);
        localStorage.setItem(key, JSON.stringify(arr));
      }
      function makeItem(text, key, id) {
        const li = document.createElement('li');
        li.className = 'draggable-item';
        li.draggable = true;
        li.innerHTML = `
          <span class="drag-handle">≡</span>
          <span class="item-text">${text}</span>
          <button class="delete-btn">✕</button>`;
        li.querySelector('.delete-btn').onclick = () => {
          li.remove();
          saveList(key, id);
        };
        li.addEventListener('dragstart', e => {
          dragSrc = li;
          e.dataTransfer.effectAllowed = 'move';
        });
        li.addEventListener('dragover', e => {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'move';
        });
        li.addEventListener('drop', e => {
          e.preventDefault();
          if (dragSrc && dragSrc !== li) {
            const parent = li.parentNode;
            const next = (dragSrc.nextSibling === li) ? dragSrc : li;
            parent.insertBefore(dragSrc, li);
            parent.insertBefore(li, next);
            saveList(key, id);
          }
        });
        return li;
      }
      function loadList(id, defaults, key) {
        const list = document.getElementById(id);
        list.innerHTML = '';
        const saved = JSON.parse(localStorage.getItem(key) || 'null');
        (saved && saved.length ? saved : defaults)
          .forEach(item => list.appendChild(makeItem(item, key, id)));
      }
      function setupInput(inpId, listId, key) {
        document.getElementById(inpId).addEventListener('keydown', e => {
          if (e.key === 'Enter') {
            const v = e.target.value.trim();
            if (!v) return;
            document.getElementById(listId)
              .appendChild(makeItem(v, key, listId));
            saveList(key, listId);
            e.target.value = '';
          }
        });
      }
      loadList('topInterestsList', ['Volleyball','VALORANT','Anime','Poker','Coding'], 'interests');
      loadList('topArtistsList', ['Taylor Swift','beabadoobee','Kendrick Lamar','The Marias','NIKI'], 'artists');
      loadList('topScheduleList', ['CIS 2620','CIS 4120','PHYS 0151','MEAM 1010','STAT 4310'], 'schedule');
      setupInput('newInterest','topInterestsList','interests');
      setupInput('newArtist','topArtistsList','artists');
      setupInput('newSchedule','topScheduleList','schedule');

      // --- 5) Opt-in/out persistence ---
      const optBtn = document.getElementById('optInBtn');
      const optText = document.getElementById('optInText');
      const OPT_KEY = 'profileOptedIn';
      let opted = localStorage.getItem(OPT_KEY) === 'true';
      function renderOpt() {
        optText.textContent =
          'New matches 4/19 7PM EST - ' +
          (opted ? 'You have opted in' : 'You have not opted in yet');
        optBtn.textContent = opted ? 'Opt Out' : 'Opt In';
      }
      optBtn.addEventListener('click', () => {
        opted = !opted;
        localStorage.setItem(OPT_KEY, opted);
        renderOpt();
      });
      renderOpt();
    });
  </script>
</body>
</html>
